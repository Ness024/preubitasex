<!-- document-history.component.html -->
<div class="document-history-container">
  <div class="header">
    <h2>
      <svg width="24" height="24" viewBox="0 0 24 24" fill="#00AEEF">
        <path d="M16 6H3V9H16V11L21 7.5L16 4V6Z"/>
        <path d="M8 18H21V15H8V13L3 16.5L8 20V18Z"/>
      </svg>
      Historial del Documento #{{currentDocumentId}}
    </h2>
  </div>

  <div *ngIf="loading" class="loading">
    <i class="fas fa-spinner fa-spin"></i> Cargando historial...
  </div>

  <div *ngIf="!loading" class="timeline">
    <div *ngFor="let step of documentSteps"
         class="timeline-step"
         [class.active]="step.isCurrent"
         [class.completed]="!step.isCurrent && step.status !== 'cancelled'"
         [class.cancelled]="step.status === 'cancelled'">

      <div class="step-header" (click)="toggleStep(step.id)">
        <div class="step-icon" [ngClass]="'status-' + step.status">
          <i [class]="getStatusIcon(step.status)"></i>
        </div>
        <div class="step-info">
          <h3>{{getStatusName(step.status)}}</h3>
          <p>{{step.date | date:'dd/MM/yyyy - HH:mm'}}</p>
        </div>
        <div class="step-actions">
          <span class="status-badge" [ngClass]="{
            'current': step.isCurrent,
            'completed': !step.isCurrent && step.status !== 'cancelled',
            'cancelled': step.status === 'cancelled'
          }">
            {{step.isCurrent ? 'Actual' : (step.status === 'cancelled' ? 'Cancelado' : 'Completado')}}
          </span>
          <i class="fas fa-chevron-down toggle-icon"></i>
        </div>
      </div>

      <div class="step-details" *ngIf="expandedSteps[step.id]">
        <!-- Detalles específicos por estado -->
        <div class="detail-grid">
          <div class="detail-item" *ngIf="step.details.receivedBy">
            <label>Recibido por:</label>
            <p>{{step.details.receivedBy}}</p>
          </div>

          <!-- Más campos según el estado -->
        </div>

        <!-- Documentos relacionados -->
        <div class="related-docs" *ngIf="step.relatedDocuments?.length">
          <h4>Documentos relacionados</h4>
          <div class="doc-grid">
            <div *ngFor="let doc of step.relatedDocuments" class="doc-card">
              <div class="doc-icon" [ngClass]="'doc-' + doc.icon">
                <i [class]="'fas fa-' + doc.icon"></i>
              </div>
              <div class="doc-info">
                <h5>{{doc.name}}</h5>
                <p>{{doc.type}}</p>
              </div>
              <a [href]="doc.url" target="_blank" class="doc-action">
                <i class="fas fa-external-link-alt"></i>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
